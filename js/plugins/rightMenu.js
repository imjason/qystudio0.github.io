const RightMenu=(()=>{const e={},t=document.getElementById("rightmenu-wrapper"),o=document.getElementById("rightmenu-content"),n=(document.getElementById("menuDarkBtn"),document.getElementById("printHtml")),i=document.getElementById("menuMusic"),l=document.getElementById("readingModel"),a=document.getElementById("read_bkg"),r=document.querySelectorAll(".menuLoad-Content"),s=document.querySelector(".menu-Option"),c=document.querySelector('.menu-Option[data-fn-type="searchWord"]'),d=document.querySelector('.menu-Option[data-fn-type="copyText"]'),u=document.querySelector('.menu-Option[data-fn-type="copyPaste"]'),m=document.querySelector('.menu-Option[data-fn-type="copySelect"]'),g=document.querySelector('.menu-Option[data-fn-type="copyCut"]'),y=document.querySelector('.menu-Option[data-fn-type="copyHref"]'),v=document.querySelector('.menu-Option[data-fn-type="copySrc"]'),p=document.querySelector('.menu-Option[data-fn-type="copyImg"]'),h=document.querySelector('.menu-Option[data-fn-type="openTab"]'),b=/^((https|http)?:\/\/)+[A-Za-z0-9]+\.[A-Za-z0-9]+[\/=\?%\-&_~`@[\]\':+!]*([^<>\"\"])*$/;return e.init=()=>{e.visible(i,!1),e.visible(s,!1),a&&a.parentNode.removeChild(a);const t=document.createElement("div");t.className="common_read_bkg common_read_hide",t.id="read_bkg",document.getElementById("BKG").parentNode.appendChild(t)},e.initEvent=()=>{window.document.oncontextmenu=t=>t.ctrlKey||document.body.offsetWidth<=500?(e.hideMenu(),!0):e.popMenu(t),t.oncontextmenu=e=>(e.stopPropagation(),e.preventDefault(),!1),window.removeEventListener("blur",e.hideMenu),document.body.removeEventListener("click",e.hideMenu),window.addEventListener("blur",e.hideMenu),document.body.addEventListener("click",e.hideMenu)},e.popMenu=n=>{let i=n.clientX,l=n.clientY,a=document.documentElement.clientWidth||document.body.clientWidth,r=document.documentElement.clientHeight||document.body.clientHeight;try{e.setMenuItem(n),e.visible(t),t.focus(),t.style.zIndex="-2147483648";let s=o.offsetWidth,c=o.offsetHeight,d=i+s>a?i-s+10:i,u=l+c>r?l-c+10:l;u=l+c>r&&u<c&&l<c?u+(r-c-u-10):u,t.style.left=d+"px",t.style.top=u+"px",t.style.zIndex="2147483648",e.showMessage()}catch(e){return t.blur(),console.error(e),!0}return!1},e.showMessage=()=>{const e="true"===localStorage.getItem("NoticRightMenu");volantis.messageRightMenu.enable&&!e&&volantis.message("右键菜单","唤醒原系统菜单请使用：<kbd>Ctrl</kbd> + <kbd>右键</kbd>",{icon:volantis.rightMenu.faicon+" fa-exclamation-square red",time:5e3},(()=>{localStorage.setItem("NoticRightMenu","true")}))},e.setMenuItem=t=>{let o=!1;const a=t.target,s=window.getSelection().toString();if(e.visible(h,!1),"input"===a.tagName.toLowerCase()||"textarea"===a.tagName.toLowerCase()){const o=a.value;o.length>0?(e.visible(m),m.onclick=()=>{t.preventDefault(),a.select()}):e.visible(m,!1),s?(e.visible(g),g.onclick=()=>{const t=a.selectionStart,n=a.selectionEnd;e.copyString(s),a.value=o.substring(0,t)+o.substring(n,o.length),a.selectionStart=t,a.selectionEnd=t,a.focus()}):e.visible(g,!1),e.readClipboard().then((t=>{t?(e.visible(u),u.onclick=()=>{e.insertAtCaret(a,t)}):e.visible(u,!1)})).catch((t=>{console.error(t),e.visible(u,!1)}))}else e.visible(m,!1),e.visible(u,!1),e.visible(g,!1);const f=a.href;f&&b.test(f)?(o=!0,e.visible(y),e.visible(h),y&&(y.onclick=()=>{e.copyString(f)}),h.onclick=()=>{window.open(f)}):e.visible(y,!1);const S=a.currentSrc;S&&b.test(S)?(o=!0,e.visible(v),e.visible(h),v.onclick=()=>{e.copyString(S)},h.onclick=()=>{window.open(S)}):e.visible(v,!1),S&&b.test(S)&&S.trimEnd().endsWith(".png")?(o=!0,e.visible(p),p.onclick=()=>{e.writeClipImg(t,(e=>{e&&volantis.messageRightMenu.enable&&volantis.message("系统提示","图片复制成功！",{icon:volantis.rightMenu.faicon+" fa-images"})}),(e=>{volantis.messageRightMenu.enable&&volantis.message("系统提示","复制失败："+e,{icon:volantis.rightMenu.faicon+" fa-exclamation-square red"})}))}):e.visible(p,!1),s?(o=!0,e.visible(d),e.visible(c),d.onclick=()=>{e.copyString(s)},c&&(c.onclick=()=>{OpenSearch(s)})):(e.visible(d,!1),e.visible(c,!1));const M=document.querySelector("#post.article")||null,w=window.location.pathname;M?(e.visible(n),e.visible(l),n&&(n.onclick=()=>{if(window.location.pathname===w){const t='是否打印当前页面？<br><em style="font-size: 80%">建议打印时勾选背景图形</em><br>';volantis.messageRightMenu.enable&&volantis.question("",t,{},(()=>{e.printHtml()}))}else e.hideMenu()}),l&&(l.onclick=()=>{window.location.pathname,e.readingModel()})):(e.visible(n,!1),e.visible(l,!1)),volantis.APlayerController&&"undefined"!=typeof MainAPlayer&&void 0!==MainAPlayer.APlayer.player?volantis.rightMenu.musicAlwaysShow?e.visible(i):"play"===MainAPlayer.APlayer.status?(o=!0,e.visible(i)):e.visible(i,!1):e.visible(i,!1),r.forEach((t=>{e.visible(t,!o)})),1==volantis.rightMenu.music&&volantis.APlayerController.APlayerLoaded&&MainAPlayer.checkAPlayer()},e.hideMenu=()=>{e.visible(t,!1)},e.copyString=e=>{VolantisApp.writeClipText(e).then((()=>{volantis.messageCopyright&&volantis.messageCopyright.enable&&volantis.messageRightMenu.enable&&volantis.message(volantis.messageCopyright.title,volantis.messageCopyright.message,{icon:volantis.messageCopyright.icon})})).catch((e=>{volantis.messageRightMenu.enable&&volantis.message("系统提示",e,{icon:volantis.rightMenu.faicon+" fa-exclamation-square red"})}))},e.writeClipText=e=>{try{return navigator.clipboard.writeText(e).then((()=>Promise.resolve())).catch((e=>Promise.reject(e)))}catch(t){const o=document.createElement("input");o.setAttribute("readonly","readonly"),document.body.appendChild(o),o.setAttribute("value",e),o.select();try{let e=document.execCommand("copy");return document.body.removeChild(o),e&&"unsuccessful"!==e?Promise.resolve():Promise.reject("复制文本失败!")}catch(e){return document.body.removeChild(o),Promise.reject("当前浏览器不支持复制功能，请检查更新或更换其他浏览器操作!")}}},e.writeClipImg=async function(e,t,o){const n=!0===volantis.rightMenu.customPicUrl?e.target.currentSrc.replace(volantis.rightMenu.picOld,volantis.rightMenu.picNew):e.target.currentSrc,i=e.target.parentElement;try{const e=await fetch(n),i=await e.blob();await navigator.clipboard.write([new ClipboardItem({[i.type]:i})]).then((()=>{t(!0)}),(e=>{console.error("图片复制失败：",e),o(e)}))}catch(e){const n=document;try{if(n.body.createTextRange){const e=document.body.createTextRange();e.moveToElementText(i),e.select()}else if(window.getSelection){const e=window.getSelection(),t=document.createRange();t.selectNodeContents(i),e.removeAllRanges(),e.addRange(t)}document.execCommand("copy"),window.getSelection().removeAllRanges(),t(!1)}catch(e){console.error(e),o("不支持复制当前图片！")}}},e.readClipboard=async()=>{const e=await navigator.permissions.query({name:"clipboard-read"});return"granted"===e.state||"prompt"===e.state?navigator.clipboard.readText().then((e=>e)).catch((e=>Promise.reject(e))):Promise.reject(e)},e.insertAtCaret=(e,t)=>{const o=e.selectionStart,n=e.selectionEnd;if(document.selection)e.focus(),document.selection.createRange().text=t,e.focus();else if(o||"0"==o){var i=e.scrollTop;e.value=e.value.substring(0,o)+t+e.value.substring(n,e.value.length),e.focus(),e.selectionStart=o+t.length,e.selectionEnd=o+t.length,e.scrollTop=i}else e.value+=t,e.focus()},e.printHtml=()=>{volantis.isReadModel&&e.readingModel(),!0===volantis.rightMenu.defaultStyles&&(e.setAttribute("details","open","true"),e.remove(".cus-article-bkg"),e.remove(".iziToast-overlay"),e.remove(".iziToast-wrapper"),e.remove(".prev-next"),e.remove("footer"),e.remove("#l_header"),e.remove("#l_cover"),e.remove("#l_side"),e.remove("#comments"),e.remove("#s-top"),e.remove("#BKG"),e.remove("#rightmenu-wrapper"),e.remove(".nav-tabs"),e.remove(".parallax-mirror"),e.remove(".new-meta-item.share"),e.remove("div.footer"),e.setStyle("body","backgroundColor","unset"),e.setStyle("#l_main","width","100%"),e.setStyle("#post","boxShadow","none"),e.setStyle("#post","background","none"),e.setStyle("#post","padding","0"),e.setStyle("h1","textAlign","center"),e.setStyle("h1","fontWeight","600"),e.setStyle("h1","fontSize","2rem"),e.setStyle("h1","marginBottom","20px"),e.setStyle(".tab-pane","display","block"),e.setStyle(".tab-content","borderTop","none"),e.setStyle(".highlight>table pre","whiteSpace","pre-wrap"),e.setStyle(".highlight>table pre","wordBreak","break-all"),e.setStyle(".fancybox img","height","auto"),e.setStyle(".fancybox img","weight","auto")),!0===volantis.rightMenu.printJs&&volantis.rightMenu.printJsFun(),setTimeout((()=>{window.print(),document.body.innerHTML="",window.location.reload()}),50)},e.readingModel=()=>{if("function"==typeof ScrollReveal&&ScrollReveal().clean("#comments"),e.fadeToggle(document.querySelector("#l_header")),e.fadeToggle(document.querySelector("footer")),e.fadeToggle(document.querySelector("#s-top")),e.fadeToggle(document.querySelector(".article-meta#bottom")),e.fadeToggle(document.querySelector(".prev-next")),e.fadeToggle(document.querySelector("#l_side")),e.fadeToggle(document.querySelector("#comments")),e.toggleClass(document.querySelector("#l_main"),"common_read"),e.toggleClass(document.querySelector("#l_main"),"common_read_main"),e.toggleClass(document.querySelector("#l_body"),"common_read"),e.toggleClass(document.querySelector("#safearea"),"common_read"),e.toggleClass(document.querySelector("#pjax-container"),"common_read"),e.toggleClass(document.querySelector("#read_bkg"),"common_read_hide"),e.toggleClass(document.querySelector("h1"),"common_read_h1"),e.toggleClass(document.querySelector("#post"),"post_read"),e.toggleClass(document.querySelector("#l_cover"),"read_cover"),e.toggleClass(document.querySelector(".widget.toc-wrapper"),"post_read"),volantis.isReadModel=void 0===volantis.isReadModel||!volantis.isReadModel,volantis.isReadModel){const t={backgroundColor:"var(--color-read-post)",icon:volantis.rightMenu.faicon+" fa-book-reader",time:5e3};volantis.messageRightMenu.enable&&volantis.message("系统提示","阅读模式已开启，您可以点击屏幕空白处退出。",t),document.querySelector("#l_body").removeEventListener("click",e.readingModel),document.querySelector("#l_body").addEventListener("click",(t=>{e.hasClass(t.target,"common_read")&&e.readingModel()}))}else document.querySelector("#l_body").removeEventListener("click",e.readingModel),document.querySelector("#post").removeEventListener("click",e.readingModel),document.querySelector(".prev-next").style.display="flex"},e.visible=(e,t=!0)=>{e&&(e.style.display=!0===t?"block":"none")},e.remove=e=>{document.querySelectorAll(e).forEach((e=>{e.remove()}))},e.setAttribute=(e,t,o)=>{document.querySelectorAll(e).forEach((e=>{e.setAttribute(t,o)}))},e.setStyle=(e,t,o)=>{document.querySelectorAll(e).forEach((e=>{e.style[t]=o}))},e.fadeIn=e=>{if(e)return e.style.visibility="visible",e.style.opacity=1,e.style.display="block",e.style.transition="all 0.5s linear",e},e.fadeOut=e=>{if(e)return e.style.visibility="hidden",e.style.opacity=0,e.style.display="none",e.style.transition="all 0.5s linear",e},e.fadeToggle=t=>{if(t)return t="hidden"==t.style.visibility?e.fadeIn(t):e.fadeOut(t)},e.hasClass=(e,t)=>{if(e)return e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))},e.addClass=(e,t)=>{if(e)return e.classList.add(t),e},e.removeClass=(e,t)=>{if(e)return e.classList.remove(t),e},e.toggleClass=(t,o)=>{if(t)return e.hasClass(t,o)?e.removeClass(t,o):e.addClass(t,o),t},{init:(t=!1)=>{e.init(),e.initEvent(),t&&volantis.messageRightMenu.enable&&volantis.message("系统提示","自定义右键注册成功。")},destroy:(t=!1)=>{e.hideMenu(),window.document.oncontextmenu=()=>!0,t&&volantis.messageRightMenu.enable&&volantis.message("系统提示","自定义右键注销成功。")},hideMenu:()=>{e.hideMenu()},readingModel:()=>{e.readingModel()}}})();Object.freeze(RightMenu),volantis.requestAnimationFrame((()=>{"loading"!==document.readyState?(RightMenu.init(),volantis.pjax.send((()=>{RightMenu.hideMenu()}))):document.addEventListener("DOMContentLoaded",(function(){RightMenu.init(),volantis.pjax.send((()=>{RightMenu.hideMenu()}))}))}));